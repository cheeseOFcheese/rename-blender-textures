# rename_albedo_textures.py

Python‑скрипт для Blender, который **переименовывает файлы текстур, подключённые к входу *Base Color* материалов (Principled BSDF)**, приводя их к единому соглашению об именовании:

```
<имя_материала>_albedo.<расширение>
```

После переименования путь к изображению автоматически обновляется внутри Blender.

---

## Что делает скрипт

Для каждого материала из `bpy.data.materials` скрипт выполняет следующие шаги:

1. Пропускает материалы, **не использующие ноды**.
2. Находит ноду **Principled BSDF**.
3. Проверяет, что вход **Base Color** подключён.
4. Убеждается, что подключённая нода — **Image Texture** (`TEX_IMAGE`).
5. Преобразует путь к изображению в **абсолютный путь**.
6. Если файл существует на диске и имеет поддерживаемое расширение — переименовывает его.
7. Формирует новое имя файла по шаблону:

   ```
   <clean_name(имя_материала)>_albedo.<ext>
   ```
8. Обновляет данные изображения в Blender:

   * `img.filepath` — новый относительный путь
   * `img.name` — имя файла без расширения

---

## Поддерживаемые форматы

Обрабатываются только следующие форматы изображений:

* `.jpg`
* `.jpeg`
* `.png`

Расширение приводится к нижнему регистру.

---

## Требования

* Blender с Python API (`bpy`)
* Текстуры должны **существовать на диске** (не только быть запакованными в `.blend`)

---

## Использование

### Вариант A — Запуск внутри Blender

1. Открой Blender.
2. Перейди в **Scripting → Text Editor**.
3. Создай новый текстовый блок и вставь код скрипта.
4. Нажми **Run Script**.

### Вариант B — Запуск из командной строки

```bash
blender /path/to/scene.blend --background --python rename_albedo_textures.py
```

---

## Детали именования

* Имя материала очищается через `bpy.path.clean_name()` (без пробелов и спецсимволов).
* Переименование происходит **в той же директории**, где лежит исходный файл.
* Если текущее имя файла уже соответствует целевому — файл пропускается.

---

## Важные замечания

* Скрипт обрабатывает **только первую связь**, подключённую к `Base Color`.
* Если **несколько материалов используют один и тот же файл текстуры**, переименование по имени материала может привести к конфликтам.
* Если файл с целевым именем уже существует, `os.rename()` может завершиться ошибкой (зависит от ОС).
* Скрипт **физически переименовывает файлы на диске** — рекомендуется использовать Git или резервные копии.

---

## Пример

Материал:

```
Wood Planks
```

Исходный файл текстуры:

```
textures/diffuse_01.PNG
```

Результат после выполнения скрипта:

```
textures/Wood_Planks_albedo.png
```

Путь и имя изображения в Blender обновляются автоматически.

---

## Типичные проблемы

* **"Файл не найден"** — путь к изображению в Blender указывает на несуществующий файл.
* **"Пропущен файл с неподдерживаемым расширением"** — формат изображения не jpg/jpeg/png.
* **Скрипт ничего не сделал** — материал без нод, нет Principled BSDF, Base Color не подключён или подключена не Image Texture нода.
